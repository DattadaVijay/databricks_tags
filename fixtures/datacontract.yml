dataContractSpecification: "0.9.3"
id: bronze-orders-contract
info:
  title: Bronze Orders Contract
  version: 1.0.0
  description: |
    This contract governs the raw ingestion of order events into the Bronze layer.
    It ensures that the landing zone data is structured correctly before being 
    processed into Silver/Gold tables.

servers:
  dev:
    host: dbc-e3761da8-7d95.cloud.databricks.com
    type: databricks
    catalog: Workspace
    schema: default

models:
  bronze_orders: 
    type: table
    streaming: true
    description: "The raw table containing immutable order event logs from the web shop."
    fields:
      event_type:
        type: string
        description: "The specific lifecycle event (e.g., Created, Cancelled)."
        enum: [OrderCreated, OrderCancelled]
      order_id:
        type: string
        description: "The business ID for the order. Expected to be non-unique in Bronze due to event logging."
        required: true
      customer_id:
        type: string
        description: "Reference ID for the customer who placed the order."
      order_ts:
        type: timestamp
        description: "The UTC event time. Renamed from order_timestamp to match physical table."
      channel:
        type: string
        description: "The platform source of the transaction."
        enum: [web, mobile]
    
    checks:
      - name: check_not_empty
        description: "Safety check to ensure ingestion hasn't stalled (expects at least 1 row)."
        must: count(*) > 0
      
      - name: unique_order_event
        description: |
          In Bronze, order_id is NOT unique because one order can have multiple events.
          This check ensures that we don't have duplicate identical events for the same order.
        must: count(*) = count(distinct order_id, event_type)